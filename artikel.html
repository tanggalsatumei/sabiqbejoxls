<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Artikel | Sabiq Bejo</title>
  <link rel="icon" href="https://img.icons8.com/emoji/48/egg-emoji.png" type="image/png">
  <style>
    body {font-family: Arial, sans-serif; margin:0; padding:20px; line-height:1.6; background:#fafafa; color:#222;}
    header {margin-bottom:20px;}
    h1 {font-size:1.8rem; margin-bottom:12px;}
    #meta {font-size:0.9rem; color:#666; margin-bottom:20px;}
    img {max-width:100%; border-radius:8px; margin:12px 0;}
    .container {max-width: 800px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08);}
    a {color:#d19e00;}
    footer {margin-top:40px; text-align:center; font-size:0.85rem; color:#777;}
    nav.breadcrumb {font-size:0.9rem; margin-bottom:15px; color:#999;}
    nav.breadcrumb a {color:#d19e00; text-decoration:none;}
    #related h3 {margin-top:40px;}
    #related ul {padding-left:18px; line-height:1.6;}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <nav class="breadcrumb">
        <a href="/">Beranda</a> › <a href="/#blog">Artikel</a> › <span id="crumb-judul">Judul</span>
      </nav>
      <a href="/" style="text-decoration:none;color:#d19e00;font-weight:bold">← Kembali</a>
    </header>

    <article>
      <h1 id="judul">Memuat...</h1>
      <div id="meta"></div>
      <img id="gambar" src="" alt="" style="display:none">
      <div id="isi">Sedang mengambil artikel...</div>
    </article>

    <section id="related">
      <h3>Artikel Lainnya</h3>
      <ul id="relatedList"><li>Sedang memuat...</li></ul>
    </section>
  </div>

  <footer>
    &copy; <span id="year"></span> CV. Sabiq Bejo
  </footer>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw7z-KG3qwpi8-AkrMPGg2ONX_gWwepiN7oKPiAcx6n_fVBjASLZ79IMxsuV99tUisCwg/exec";
const API_TOKEN = "1_sE-EY0hPXT_mQBg7sifRUoDAon6DvQNQZcUsrwnD0A";

function getQueryParam(name){
  const url = new URL(window.location.href);
  return url.searchParams.get(name);
}

async function fetchSheet(sheet){
  const res = await fetch(`${API_URL}?sheet=${encodeURIComponent(sheet)}&token=${API_TOKEN}`, {cache:"no-cache"});
  const txt = await res.text();
  try {
    return JSON.parse(txt).data || [];
  } catch(e) {
    console.error("Parse error:", e, txt);
    return [];
  }
}

async function loadArticle(){
  const slug = (getQueryParam("slug")||"").trim().toLowerCase();
  if(!slug){ document.getElementById("isi").innerText = "Slug artikel tidak ditemukan."; return; }

  const rows = await fetchSheet("Artikel");
  const artikel = rows.find(r => ((r.slug||"").trim().toLowerCase() === slug));

  if(!artikel){
    document.getElementById("judul").innerText = "Artikel tidak ditemukan";
    document.getElementById("isi").innerText = "Maaf, artikel dengan slug '"+slug+"' tidak tersedia.";
    return;
  }

  document.title = artikel.judul + " | Sabiq Bejo";
  document.getElementById("judul").innerText = artikel.judul || "Artikel";
  document.getElementById("crumb-judul").innerText = artikel.judul || "Artikel";
  document.getElementById("meta").innerText = artikel.tanggal ? `Dipublikasikan pada ${artikel.tanggal}` : "";
  
  if(artikel.gambar){
    const img = document.getElementById("gambar");
    img.src = artikel.gambar;
    img.alt = artikel.judul || "";
    img.style.display = "block";
  }

  document.getElementById("isi").innerHTML = artikel.isi || artikel.deskripsi || "Belum ada konten.";
  loadRelated(slug);
}

async function loadRelated(currentSlug){
  const rows = await fetchSheet("Artikel");
  const list = document.getElementById("relatedList");
  list.innerHTML = "";
  rows.filter(r => (r.slug||"").trim().toLowerCase() !== currentSlug)
      .slice(0,5).forEach(r=>{
    const li = document.createElement("li");
    li.innerHTML = `<a href="/artikel.html?slug=${r.slug}" target="_blank">${r.judul}</a>`;
    list.appendChild(li);
  });
}

document.getElementById("year").innerText = new Date().getFullYear();
loadArticle();
</script>
</body>
</html>
